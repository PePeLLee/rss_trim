<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSS Trim</title>
</head>
<body>
    <h1>Latest 5 Episodes</h1>
    <div id="rss-feed"></div>

    <script>
        // Function to get URL parameters
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            const results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        async function fetchRSS(url) {
            const response = await fetch(url);
            const text = await response.text();
            return new window.DOMParser().parseFromString(text, "text/xml");
        }

        function parseRSS(xml) {
            const items = xml.querySelectorAll("item");
            let episodes = [];
            items.forEach(item => {
                const title = item.querySelector("title").textContent;
                const link = item.querySelector("link").textContent;
                const description = item.querySelector("description").textContent;
                episodes.push({ title, link, description });
            });
            return episodes;
        }

        function displayEpisodes(episodes) {
            const container = document.getElementById("rss-feed");
            container.innerHTML = "";
            episodes.forEach(episode => {
                const episodeDiv = document.createElement("div");
                episodeDiv.innerHTML = `
                    <h2><a href="${episode.link}">${episode.title}</a></h2>
                    <p>${episode.description}</p>
                `;
                container.appendChild(episodeDiv);
            });
        }

        async function loadLatestEpisodes() {
            const rssUrl = getUrlParameter('rssUrl'); // Get RSS feed URL from URL parameters
            if (!rssUrl) {
                document.getElementById("rss-feed").innerHTML = "No RSS feed URL provided.";
                return;
            }
            const xml = await fetchRSS(rssUrl);
            let episodes = parseRSS(xml);
            episodes = episodes.slice(0, 5); // Trim to the latest 5 episodes
            displayEpisodes(episodes);
        }

        loadLatestEpisodes();
    </script>
</body>
</html>
